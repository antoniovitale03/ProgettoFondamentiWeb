Configurazione iniziale per un progetto React + Node.js
1. Dopo aver creato la repository vuota, su WebStorm ho creato un nuovo progetto con il version control di Git.
2. Creo la cartella client e li eseguo "npx create-react-app ."
3. Creo la cartella server e li eseguo "npm install" (o alternativamente "npm init -y")

Dominio del deploy: https://cinesync-front-end.onrender.com/   (piattaforma Render)


## DOCUMENTAZIONE
### FRONTEND
#### About: Ha lo scopo di spiegare agli utenti perchè esiste CineSync e a quali utenti è indirizzata. Evidenzia anche le caratteristiche principali del sito.
#### Activity: Permette di visualizzare ogni attività recente svolta dall’utente all’interno del sito web. La componente è composta da blocchi if per eseguire un render mirato a seconda del tipo di azione svolta.
#### ActivityPage: Inizializza, scarica e visualizza l’intera cronologia delle attività (come recensioni, aggiunto film ai preferiti etc…) dell’utente. 
#### ActorPage: Pagina che mostra tutte le informazioni principali relative ad un attore: Data di nascita, Biografia. Inoltre è possibile visualizzare in quali film l’attore ha recitato o in quali film ha svolto un ruolo tecnico.  Tutto ciò è permesso  tramite chiamate all’API la quale recupera tutti i dati relativi a un attore utilizzando il suo ID univoco come parametro di ricerca.
#### Archive: Mostra l’intero catalogo dei film. Organizza i risultati in una griglia grazie alla componente FilmCard e gestisce l’interfaccia con Pagination (componente di MUI) per sfogliare l’archivio.  Sono presenti anche dei filtri quali: genere, anno, valutazione generale del film, ordina per popolarità e ordina in base alla data. Il loro funzionamento è possibile grazie alla chiamata dell’API che interviene e viene chiamata ogni volta che i filtri o la pagina viene modificata.
#### Carosello: Componente presente nella pagina Home del sito. Permette di sfogliare rapidamente un sottoinsieme di film all’interno di una categoria scorrendo lateralmente con un max di 5  visualizzabili alla volta.  Cliccando su qualsiasi elemento del carosello l’utente verrà reindirizzato direttamente alla pagina di dettaglio del film (FilmPage).   Le categorie presenti sono: Popolari, Usciti in Italia, Acclamati dalla critica, Attualmente al cinema, In tendenza questa settimana, Film simili a quelli visti.
#### CastPage: Fornisce una visione completa di tutti gli attori che hanno partecipato al film, permettendo all’utente di navigare dal film al profilo di ogni singolo attore (ActorPage). 
#### Contact: Pagina che mostra i componenti del team che hanno creato il sito web e le loro rispettive email con le quali è possibile mettersi in contatto.
#### CrewPage: Fornisce una visione completa di tutti i membri della crew che hanno partecipato al film con i loro relativi ruoli. È possibile essere indirizzati solamente alla pagina del regista (DirectorPage)
#### DirectorPage: Pagina che mostra tutte le informazioni principali relative al regista : Data di nascita, Biografia. Inoltre è possibile visualizzare in quali film il regista ha recitato o in quali film ha svolto uno o più ruoli tecnici.  Tutto ciò è permesso  tramite chiamate all’API la quale recupera tutti i dati relativi al regista utilizzando il suo ID univoco come parametro di ricerca.
#### DropDownMenu: È una componente riutilizzabile che gestisce un menu a discesa. Il suo compito è quello di mostrare o nascondere un contenuto quando l’utente clicca su un pulsante, gestendo l’ancoraggio e lo stato di apertura  attraverso le proprietà passate dalla componente che lo invoca.
#### FavoritesFilm: Permette di visualizzare la lista dei film preferiti di un utente specifico recuperata tramite API. I film vengono visualizzati in una griglia con le loro apposite FilmCard.   È possibile rimuovere un film dalla propria lista e inoltre è possibile vedere la lista dei film preferiti di un altro utente amico.
#### FilmsByYear: Ha il compito di visualizzare un catalogo di film specificamente limitato a un singolo anno di uscita. I film vengono recuperati tramite l’API , in base all’anno specificato, e disposti in una griglia di FilmCard. Ciascuna FilmCard reindirizza alla pagina del film in questione (FilmPage).
#### Followers: Componente che recupera e mostra l’elenco dei follower per un utente specifico la cui username è ottenuta dall’URL. Ogni follower presenta una UserCard.
#### Following: Componente che serve a mostrare l’elenco degli utenti seguiti su un account specifico. Include anche la logica per permettere all’utente che sta visualizzando la pagina di smettere di seguire qualcuno, se è il suo elenco.
#### FOOTER: componente che rappresenta la barra inferiore del sito web, che ha la funzione di facilitare all’utente l’accesso alle sezioni informative.
#### HEADER: componente che rappresenta la barra superiore del sito web. Nel caso in cui l’utente non è loggato, l’header presenterà i due tasti per la registrazione o per il login, altrimenti permetterà all’utente di accedere al menù utente, all’archivio dei film, ad un menù per aggiungere un amico e ad una barra di ricerca che consente di cercare un film.
#### HELP: rappresenta la pagina di supporto del sito web, contenente un modulo con campi per email, titolo e descrizione del problema per inviare richieste di assistenza. Gestisce i messaggi di errore e conferma tramite stato locale e mostra una risposta automatica. 
#### HOME: rappresenta la pagina principale del sito e mostra una panoramica dei film disponibili e consigliati attraverso la componente Carosello. Recupera dati attraverso chiamate API e personalizza i contenuti in base all’utente loggato.
#### LIST: gestisce la visualizzazione di una lista di film appartenente a un determinato utente. Recupera i dati attraverso chiamate API e li mostra in una griglia di FilmCard, permettendo all’utente di rimuovere film dalla lista aggiornando dinamicamente la visualizzazione.
#### LISTS: pagina che gestisce tutte le liste di film di un utente. Permette all’utente loggato di creare nuove liste tramite un menù interattivo.
#### MAINCONTENT: gestisce la navigazione principale dell’applicazione tramite React Router e carica dinamicamente le varie pagine in base all’URL e allo stato di autenticazione dell’utente.
#### PANEL: componente che gestisce la struttura dell’applicazione in verticale.
#### PROFILE: pagina del profilo utente, che mostra informazioni personali, avatar, biografia, followers/following e attività recenti. Permette inoltre di modificare il profilo e rimuovere film dai preferiti.
#### REVIEWS: mostra le recensioni di un utente recuperate tramite API e le visualizza in una griglia di ReviewCard. Permette al proprietario di rimuovere recensioni e applicare filtri dinamici tramite la componente SearchFilters.
#### SEARCHFILMRESULT: pagina che mostra i risultati di ricerca di un film. Recupera i film tramite API e li visualizza in una griglia di FilmCard, permettendo di applicare filtri dinamici tramite SearchFilters.
#### SEARCHFILTERS: componente che permette di filtrare film o recensioni. Gestisce film per genere, decade, rating minimo, ordinamento e film piaciuti o non piaciuti. Aggiorna dinamicamente i criteri con setFilters.
#### USERMENU: menu a tendina dell’utente loggato che fornisce accesso rapido alle sezioni personali e alle impostazioni dell’account, includendo anche il tasto logout.
#### WATCHED: pagina che mostra i film visti da un utente. Recupera i film tramite API e permette di applicare filtri dinamici.
#### WATCHLIST: pagina che mostra i film che un utente vuole guardare. Recupera i film tramite API e permette di applicare filtri dinamici. Permette inoltre di rimuovere film dalla watchlist.
#### CONTEXT
#### AUTHCONTEXT: gestisce lo stato di autenticazione globale dell’utente. Fornendo a tutti i componenti: user, ilLoggedIn, logout e setUser tramite AuthProvider. Mantiene la sessione persistente con localStorage e gestisce il logout reindirizzando l’utente.
#### NOTIFICATIONCONTEXT: permette a qualsiasi componente figlio di mostrare notifiche. La notifica si chiude automaticamente dopo 4 secondi o può essere chiusa manualmente.
#### CARDS
#### ActorCard: Visualizza una singola card contenente le informazioni di un attore all’interno di un’applicazione. Cliccando reindirizza l’utente a una pagina con informazioni dettagliate sull’attore.
#### CrewMemberCard: Componente che ha il compito di creare una scheda con nome e immagine di un membro della crew. Utilizzata per essere inserita in una griglia.
#### FilmCard: Componente che permette di visualizzare i dettagli essenziali di un film quali titolo, anno e locandina del film. Presenta anche un bottone “Rimuovi” visualizzabile solo nel caso in cui il film è stato aggiunto nelle proprie liste (es aggiunto alla lista dei preferiti,aggiunto alla watchlist…).Cliccando sulla card del film si verrà reindirizzati alla pagina FilmPage che mostrerà ancora più dettagli del film.
#### ReviewCard: Permette di visualizzare una recensione di un film. A sinistra verranno mostrati i dettagli del Film quali: locandina, titolo e anno, quest'ultimi se cliccati reindirizza l’utente alla pagina FilmPage (se si clicca su titolo), alla pagina FilmByYears(se si clicca sull’anno). A destra invece verrà mostrata la recensione scritta. È possibile eliminare la recensione tramite il pulsante apposito Rimuovi.
#### UserCard:  Componente progettata per visualizzare rapidamente le informazioni essenziali di un profilo. Permette di vedere l’avatar e il nome utente (entrambi cliccabili per accedere al profilo completo), oltre al numero di follower e di seguiti che l’utente ha. Include inoltre una barra di icone di accesso rapido che consentono di navigare direttamente in sezioni come Watchlist,Recensioni…Inoltre la card può includere un pulsante rimuovi per smettere di seguire un utente.
#### FILMPAGE
#### CastCrewMoreInfo: Ha il compito di organizzare in maniera compatta tramite la componente Accordion di MUI altre info del film quali: Cast, Crew e Altre Info.  Ogni volta che l’utente espande l’Accordion Cast si può vedere un’anteprima degli attori con il loro rispettivo ruolo all’interno del film, inoltre cliccando su ‘Mostra altri…’ si verrà reindirizzati a CastPage mentre nel caso si dovesse cliccare sull’attore si verrebbe reindirizzati alla pagina ActorPage.    Se l’utente espande l’Accordion Crew può vedere un’anteprima di tutti i membri della crew e il loro ruolo tecnico. Cliccando su ‘Mostra altri…’ si verrà reindirizzati alla pagina CrewPage.     Se l’utente espande l’Accordion Altre Info può visualizzare altre informazioni relative al film quali: lingua originale, budget…
#### FilmButtons: Componente che gestisce lo stato e le interazioni dell’utente relative a un film specifico. Presenta una barra con 6 icone ognuna delle quali svolge una funzione specifica.   Le funzioni che si possono eseguire sono: Aggiungi/Rimuovi  dalla watchlist ; Aggiungi/Rimuovi dai film preferiti; Aggiungi/Rimuovi dai film piaciuti, Aggiungi una recensione, Aggiungi/Rimuovi dai film visti e Aggiungi/Rimuovi da una lista.    Ogni iterazione genera una chiamata al server che non solo aggiorna in tempo reake lo stato del profilo, ma cambia immediatamente l’aspetto visivo dell’icona(ad esempio da vuota a piena) per fare conferma visiva dell’azione. L’utente inoltre riceve una notifica istantanea che conferma il successo dell’operazione e un link di reindirizzamento diretto. Così, se per esempio, aggiungiamo un film ai preferiti si può passare direttamente alla propria pagina dei film preferiti e così via con tutte le possibili operazioni.
#### FilmCollection: Ha lo scopo di visualizzare una serie di film ,se presenti, che fanno parte di una serie o di una “saga” presentandoli in una griglia responsiva con le loro apposite FilmCard interattive (Nel caso si dovesse cliccare si verrà reindirizzati alla FilmPage di quel film).
#### FilmDetailsMenu: Visualizza i dettagli tecnici e finanziari di un film. È collegato alla componente CastCrewMoreInfo in quanto FilmDetailsMenu viene renderizzata all'interno dell'ultimo Accordion di CastCrewMoreInfo con il titolo “More Info”.
#### FilmPage: Pagina dedicata a visualizzare tutti i dettagli di un singolo film.  Per iniziare troviamo il titolo e l’anno (se cliccato reindirizza a FilmByYears) e il nome del regista (se cliccato reindirizza a DirectorPage).  Successivamente la pagina si divide in due colonne principali (tramite la componente MUI Grid): nella colonna di sinistra è presente la durata, la locandina , il rating medio dei film e eventualmente il rating personale dell’utente (solo se il film è recensito) e la componente FilmProviders.   Nella colonna di destra invece troviamo l’eventuale slogan e la trama del film. A seguire troviamo un’icona Youtube che, se cliccata ti reindirizza al Trailer del film, i generi del film, un link per navigare alla pagina che elenca i “Film simili” a quello corrente (SimilarFilm), la componente CastCrewInfo e per terminare la componente FilmCollection.  Tutto ciò è permesso tramite l’API che trova e restituisce questi dati dopo aver ricevuto l’ID del film richiesto dalla pagina web.  
#### FilmProviders: Mostra all’utente dove può noleggiare, acquistare o guardare in streaming un film.
#### SimilarFilms: Componente che gestisce la visualizzazione dei film correlati a un titolo specifico. Cliccando su ‘Film simili a {nome del film}’ si verrà reindirizzati in una pagina che permette all’utente di vedere i film suggeriti come simili. Ciò è permesso perchè la componente utilizza l’API che riceve l’ID del film di riferimento e si occupa di interrogare il database per trovare e fornire una lista di film pertinenti. 
#### REGISTRATION
#### RegistrationForm: Gestisce la prima fase del processo di registrazione utente: la raccolta delle credenziali e l’invio di una richiesta al server per avviare la verifica dell’email. Ciò è permesso dall’API che verifica che i dati siano unici e validi, salva il nuovo utente nel database e invia un codice di verifica all’indirizzo email fornito per autenticare l’identità dell’utente.
#### RegistrationPage: Gestisce l’intero flusso di registrazione di un utente suddividendo in due fasi distinte: step (1) viene mostrato il componente RegistrationForm dove l’utente inserisce username,email e password, step (2) viene mostrato il componente VerificationForm dove l’utente inserisce il codice di verifica via email.  
#### VerificationForm: Presenta un campo per l’inserimento del codice di verifica ricevuto via email dall’utente completando così il processo di registrazione a due fasi.
#### SETTINGS
#### DELETEACCOUNT: permette all’utente di eliminare definitivamente il proprio account. Chiede la conferma dell’email, invia una richiesta “delete” al server e in caso di successo mostra una notifca.
#### MODIFYPASSWORD: permette all’utente di modificare la propria password. Invia una richiesta “post” al backend con la vecchia e la nuova password, verificandone la correttezza. Mostra una notifica e reindirizza in Homepage in caso di successo.
#### MODIFYPROFILE: permette all’utente di modificare i dati del proprio account, caricando automaticamente le informazioni correnti tramite una richiesta al backend e permette di aggiornarle. Alla conferma invia i nuovi dati al server.
 
#### HOMEPAGEFILMS
#### CURRENTPOPULARFILMS: componente che mostra l’elenco aggiornato dei film più popolari del momento, sfruttando i dati ottenuti dal backend tramite API.
#### NOWPLAYINGFILMS: componente che mostra tutti i film attualmente in sala, sfruttando i dati ottenuti dal backend tramite API.
#### TOPRATEDFILMS: componente che mostra i film più acclamati dalla critica o dagli utenti, recupera i dati dal backend tramite API.
#### TRENDINGFILMS: componente che mostra i film di tendenza della settimana, recupera i dati dal backend tramite API.
#### UPCOMINGFILMS: componente che mostra i film in uscita in italia, recupera i dati dal backend tramite API.
HOOKS
#### USEALLGENRES: custom hook di React che fornisce una lista di tutti i generi cinematografici disponibili, recuperandoli tramite API.
#### USEDECADES: custom hook di React che genera un array contenente tutte le decadi dal decennio corrente fino al 1870.
#### USEDOCUMENTTITLE: custom hook di React che permette di aggiornare dinamicamente il titolo della pagina.
#### USEGETSEARCHPARAMS: converte un oggetto di filtri in una stringa di query URL e vinee utilizzato per costruire query string dinamiche quando si effettuano richieste API basate su filtri di ricerca.
#### USESLEEP: funzione asincrona che ritarda l’esecuzione del codice per un determinato intervallo di tempo.

### BACKEND
L’applicazione utilizza tre principali router:
#### app.use('/api/auth',authRouter);
#### app.use('/api/user',userRouter);
#### app.use('/api/films', filmRouter);
#### authRouter
gestisce le API per l’autenticazione (login, registrazione, logout e refresh dell’accessToken)
#### /registration: gestisce la prima fase di registrazione. Prende i dati inseriti dall’utente (username, email, password) e controlla che email e username non siano già in uso, in modo da mandare la mail all’utente con il codice di verifica, hashare la password e generare la data di scadenza del codice (5 min). Email, username, password, codice di verifica e data di scadenza sono salvati come documento PendingUser, documento temporaneo che viene usato dal backend per salvare il codice di verifica e confrontarlo in un secondo momento con quello inserito dall’utente.
 
#### /registration/verify: gestisce la seconda fase di registrazione, in cui viene verificato se la mail è posseduta effettivamente dall’utente. L’endpoint riceve la mail dell’utente e il codice di verifica da lui inserito e controlla (usando la mail) se esiste il documento PendingUser, in tal caso verifica che non sia scaduto il codice e che il codice dell’utente corrisponde a quello contenuto nel documento del DB. A questo punto viene creato il documento User con username, email, password (presi da PendingUser) e il documento PendingUser viene eliminato.
#### /login: gestisce la logica di login. Riceve email e password dall’utente: verifica prima di tutto se esiste un documento User con quella mail, in caso positivo controlla che la password inserita dall’utente sia la stessa di quella contenuta nel DB (che è hashata, per questo usiamo bycript.compare). Dopodichè costruisce un oggetto payload con i dati essenziali dell’utente: id del documento User a cui appartiene, username ed email. Utilizzando questo payload e un JWT secret (variabile d’ambiente), vengono firmati access token e refresh token (con scadenze rispettivamente di 15 minuti  e7 giorni).
Il refresh token viene salvato nel documento User nel DB e può essere incapsulato nel cookie solo se viene fatta richiesta a /api/auth/refresh, quindi quando è necessario refreshare l’access token (per una maggiore sicurezza).
L’access token, e I dati dell’utente (id, username ed email) vengono inviati al front-end, che li salverà nella variabile di stato user gestita dal contesto di autenticazione.
#### /forgot-password: endpoint che viene richiamato quando l’utente ha dimenticato la password. Riceve l’email inserita dall’utente, verifica che esiste un documento User con quella mail, invia un codice di verifica alla mail e setta una scadenza del codice, e inserisce questi dati in un documento temporaneo PendingUser.
#### /login-verify: verifica la correttezza del codice di verifica inserito dall’utente. Riceve email e codice di verifica, trova il documento PendingUser dall’email e verifica che il codice nel documento non sia scaduto e che corrisponda a quello inserito dall’utente, in tal caso elimina il documento temporaneo ed invia al front-end un messaggio di successo.
#### /set-new-password: serve per validare l’impostazione della nuova password dopo la verifica del codice. Riceve email, password e conferma della password. Trova il documento User dall’email, verifica che la password e la conferma corrispondano, dopodichè hasha la password e la salva nel DB.
#### /refresh: endpoint richiamato quando l’access token scade (ogni 15 minuti). Preleva il refresh token dai cookie della richiesta, come è stato detto prima viene integrato nella richiesta solo in questa API. Se il refresh token è scaduto (sono passati 7 giorni dall’ultimo login), allora il backend notifica il front end con un errore 401 indicando che l’utente deve fare di nuovo login, per poter generare un nuovo refresh token (e quindi anche l’access token).
Se il refresh token non è ancora scaduto, viene trovato prima di tutto il documento User con questo token (ricordiamo che durante il login viene salvato nel DB) e, attraverso il JWT SECRET, viene calcolato l’oggetto payload e viene verificato l’id contenuto nel payload corrisponda a quello del documento User. Dopodichè questo payload viene usato per firmare un nuovo access token, che viene inviato al front end, il quale lo integrerà in ogni richiesta successiva nell’header Authorization per poter sfruttare le API protette.
#### /logout: gestione del logout lato backend, in cui viene eliminato il refresh token nel documento DB dell’utente (stringa vuota) e viene notificato al front end di cancellare il refresh token dai cookie impostando una scadenza nel passato (tutto gestito da clearCookie).
 
#### userRouter:
gestisce le API direttamente connesse all’utente (modifica della password o dell’avatar, eliminazione account, ottenere le informazioni del profilo, ecc.)
 
#### /:username/get-profile-info:  viene usato per ottenere tutti i dati del profilo di un utente, conoscendo il suo username che permette di trovare il documento User relativo all’utente, per poi popolare le proprietà “favorites”, “watched”, “reviews” (di quest’ultima popoliamo anche la sua proprietà “film”). Dopodichè vengono filtrate le proprietà utili e inviate al front-end.
#### /:username/get-following: serve per ottenere la lista di tutte le persone seguite da un utente, conoscendo il suo username. Trovato il documento User a partire dallo username, viene popolata la proprietà following e viene inviato l’oggetto user al front-end.
#### /:username/get-followers: serve per ottenere la lista di tutti i follower di un utente, conoscendo il suo username. Trovato il documento User a partire dallo username, viene popolata la proprietà followers e viene inviato l’oggetto user al front-end.
#### /:friendUsername/follow:  viene chiamato nel momento in cui un utente segue un amico. Essenzialmente viene aggiunto l’id dell’amico alla proprietà following dell’utente e, specularmente, l’id dell’utente nella proprietà followers dell’amico.
#### /:userId/unfollow: viene chiamato quando l’utente smette di seguire un amico. Viene rimosso l’id dell’amico nella proprietà following dell’utente e l’id dell’utente nella proprietà followers dell’amico.
#### /delete-account/:confirmEmail: a partire dall’email di conferma inserita dall’utente, calcola il documento User del DB e se la sua proprietà email corrisponde all’email di conferma, il documento viene eliminato dal DB.  
#### /get-profile-data: permette di ricavare le informazioni principali del profilo che andranno a popolare il form nel componente ModifyProfile
#### /update-profile: viene chiamato quando l’utente vuole aggiornare le informazioni del suo profilo: i dati inseriti nel form vengono inseriti nel documento DB appartenente all’utente.
#### /modify-password: permette di modificare la password dell’utente (N.B. quando l’utente è già loggato). Riceve la vecchia password, la nuova password e la conferma della nuova password. Se la vecchia password corrisponde a quella contenuta nel documento User e la nuova password corrisponde alla conferma, allora viene hashata la nuova password e salvata nel DB.
#### /:username/get-activity: consente di ottenere tutte le attività di un utente, conoscendo il suo username, che permette di ricavare il documento User e di popolare la sua proprietà “activity” (e la proprietà “user” al suo interno). Vengono filtrate tutte le attività fino ad un mese fa (applicando la funzione timeAgo alla data) e vengono inviate al front end (con la proprietà timeAgo).
 
 
#### filmRouter
gestisce tutte le API che hanno a che fare con i film (ottenere i film della watchlist, la pagina di un film, le recensioni, l’archivio dei film, pagina del cast e della crew, ecc..)
Delega alcune funzioni ad altri router, per garantire una maggiore scalabilità. Ogni router a se stante utilizza un controller specifico diverso da filmController (es. homeController per homeRouter, watchlistController per watchlistRouter, ecc.).
#### router.use("/home", homeRouter) : gestione dei film da mostrare nella home page
#### router.use("/lists", listsRouter): gestione delle liste dei film dell’utente
#### outer.use("/watchlist", watchlistRouter): gestione dei film che l’utente ha inserito nella watchlist
#### router.use("/liked", likedRouter): gestione dei film a cui l’utente ha messo like
#### router.use("/reviews", reviewsRouter): gestione delle recensioni dei film scritte dall’utente
#### router.use("/favorites", favoritesRouter): gestione dei film preferiti dell’utente
#### router.use("/watched", watchedRouter): gestione dei film visti dall’utente
 
#### /get-similar-films: permette di ottenere i film simili ad un altro film specificando il suo id (facendo riferimento all’api di TMDB) e la pagina richiesta.
#### /get-cast/:filmID: permette di ottenere il cast di un film, conoscendo il suo ID, usando l’api di TMDB.
#### /get-crew/:filmID: permette di ottenere la crew di un film, conoscendo il suo ID, usando l’api di TMDB.
#### /get-all-genres: permette di ottenere tutti i generi dei film (nome del genere + id ) usando l’api di TMDB, in modo da mostrarli nel menu a tendina nei filtri di ricerca.
#### /get-archive: permette di ottenere la lista dei film nell’archivio sulla base dei parametri di ricerca inseriti dall’utente e inviati nella query della richiesta. L’api di TMDB con la funzione discover permette di inserire i parametri di ricerca direttamente nell’url, per poi poter fare un fetch finale.
#### /get-search-results/:filmTitle :  permette di ottenere la lista di tutti i film trovarti a partire dalla query di ricerca dell’utente, sfruttando la funzione search dell’api di TMDB. Diversamente dalla funzione discover, non è possibile inserire i parametri di ricerca direttamente nell’url per cui è necessario modificare di volta in volta l’oggetto films.
#### /get-film/:filmID  : consente di ottenere tutti i dati di un film da mostrare successivamente nella pagina del film, a partire dall’id del film nell’api di TMDB.
#### /get-films/:year  : permette di ottenere tutti i film usciti in uno specifico anno (per una specifica pagina) usando la funzione discover dell’api di TMDB
#### /get-actor-info/:actorID  : permette di ottenere tutte le info di un attore (partendo dal suo id definito dall’api di TMDB), usando la funzione person (info personali + cast + crew).
#### /get-director-info/:directorID  : permette di ottenere tutte le info di un regista (partendo dal suo id definito dall’api di TMDB), usando la funzione person (info personali + cast + crew).
 
#### homeRouter
 
#### /get-home-page-films:  permette di visualizzare tutti i film da mostrare nella home page utilizzando la funzione “movie” dell’API di TMDB (film attualmente più popolari, film in uscita in Italia, film acclamati dalla critica,  film attualmente al cinema, film in tendenza). Se l’utente è loggato allora mostro anche i film simili a quelli che già visto: ad ogni render della home vengono presi 4 film casuali da quelli già visti dall’utente e per ognuno di essi prendo 5 film simili, in modo da mostrare in totale 20 film nel carosello.
#### /get-current-popular-films/page/:pageNumber: mostra i film più popolari usando l’api di TMDB, in base alla pagina richiesta.
#### /get-upcoming-films/page/:pageNumber: mostra i film in uscita in Italia usando l’api di TMDB, in base alla pagina richiesta.
#### /get-top-rated-films/page/:pageNumber: mostra i film più acclamati dalla critica in Italia usando l’api di TMDB, in base alla pagina richiesta.
#### /get-now-playing-films/page/:pageNumber: mostra i film attualmente al cinema usando l’api di TMDB, in base alla pagina richiesta.
#### /get-trending-films/page/:pageNumber: mostra i film in tendenza usando l’api di TMDB, in base alla pagina richiesta.
 
 
#### listsRouter
#### /create-list/:listName: crea una nuova lista sulla base del nome inserito come parametro dell’url. Ogni lista fa riferimento all’utente che l’ha creata (cioè dall’id del suo documento User). Se esiste già una lista con quel nome e con l’id dell’utente che ha fatto richiesta, non crea la lista e notifica il front end che la lista già esiste.
Dopo aver creato il documento Lista, aggiunge il suo id alla proprietà lists del documento User.
#### /get-lists/:username : permette di ottenere tutte le liste appartenenti ad un utente (di cui specifichiamo lo username nell’url). Trova il documento User a partire dallo username e popola la proprietà “lists” (e all’interno anche la proprietà “films”)
#### /get-list/:username/:listName: permette di trovare tutti i film di una lista, specificando il suo nome e lo username dell’utente a cui appartiene. Dopo aver trovato l’utente con lo username specificato e aver popolato la proprietà “lists” del documento User e la proprietà interna “films”, trova all’interno della proprietà “lists” (ora popolata), l’oggetto lista che ha il nome corrispondente a quello indicato come parametro.
 
#### watchlistRouter
#### /add-to-watchlist : permette di aggiungere alla watchlist un film. Riceve l’intero oggetto film dal front end e trova il documento Film che ha come id quello indicato dall’api di TMDB. Se non lo trova ne crea uno nuovo. Crea un nuovo documento Activity. Trova il documento User sulla base dell’id contenuto nel payload aggiunge nel documento User alla proprietà “watchlist” l’id del film e alla proprietà “activity” l’id del documento Activity precedente creato.
/remove-from-watchlist/:filmID: permette di rimuovere un film dalla watchlist, utilizzando soltanto l’id del film come parametro. Sostanzialmente trova il documento User a partire dall’id contenuto nel payload ed elimina l’id del film dalla proprietà watchlist del documento User.
/get-watchlist/:username:  permette di ottenere tutti i film contenuti nella watchlist di un utente a partire dal suo username. Più nel dettaglio trova il documento User a partire dallo username e popola la proprietà watchlist. Dopodichè filtra il risultato sulla base dei parametri di ricerca inseriti.
 
#### likedRouter
#### /add-to-liked: aggiunge un film ai film piaciuti dell’utente. Riceve l’intero oggetto film dal front end e trova il documento Film che ha come id quello indicato dall’api di TMDB. Se non lo trova ne crea uno nuovo. Dopodichè trova il documento User sulla base dell’id contenuto nel payload e aggiunge alla proprietà “liked” del documento User l’id del film.
#### /remove-from-liked/:filmID:  permette di rimuovere un film (specificando l’id nell’url), dalla lista dei film piaciuti dell’utente. Trova il documento User a partire dall’id contenuto nel payload ed elimina l’id del film dalla proprietà “liked” del documento User.
 
 
#### reviewsRouter
#### /add-review: aggiunge una recensione alla lista delle recensione dell’utente. Riceve dal front end l’intero oggetto film, la recensione e il rating (anche nullo). Crea un nuovo documento Recensione e un nuovo documento Activity sulla base della recensione e del rating (+ data attuale) .Trova il documento User sulla base dell’id inserito nel payload e inserisce nella proprietà “reviews” l’id del documento Recensione, nella proprietà “activity” l’id del documento Activity  e nella proprietà “watched” l’id del film (un film recensito significa che è stato anche visto dall’utente).
#### /delete-review/:filmID: permette di rimuovere una recensione conoscendo l’id del film. Trova il documento Recensione da eliminare (quello che come proprietà film l’id del film inserito nell’url) ed elimino il suo id dalla proprietà “reviews” del documento User, dopodichè procedo ad eliminare il documento Recensione.
#### /get-reviews/:username: permette di ottenere la lista delle recensioni scritte da un utente (di cui viene specificato lo username). A partire dallo username trova il documento User e popola la proprietà “reviews” (e anche la proprietà “film”), dopodichè applico all’oggetto trovato tutti i filtri di ricerca che l’utente ha inserito.
 
 
#### favoritesRouter
#### /add-to-favorites: aggiunge un film alla lista dei film preferiti dall’utente. Riceve l’oggetto film dal front end, che utilizza per creare il documento Film (se ancora non esiste). Prima di tutto trova il documento User a partire dall’id contenuto nel payload e controlla che nella lista della proprietà “favorites” ci siano meno di 10 film, altrimenti invia al front end un messaggio di errore indicando che non è possibile aggiungere il film poiché si violerebbe il limite massimo dei film preferiti che è possibile avere (10). Viene creato un documento Attività e si inserisce nella proprietà “favorites” l’id del film e nella proprietà “activity” l’id del documento Attività appena creato.
#### /remove-from-favorites/:filmID:  permette di rimuovere un film dai preferiti (conoscendo l’id del film). Trova il documento User a partire dall’id dell’utente contenuto nel payload ed elimina nella proprietà “favorites” l’id del film.
#### /get-favorites/:username: permette di ottenere la lista dei film preferiti di un utente (conoscendo il suo username). Trova il documento User sulla base dello username e popola la proprietà “favorites”, dopodichè viene inviato l’oggetto al front-end.
 
#### watchedRouter
#### /add-to-watched: aggiunge un film alla lista dei film visti dall’utente. Riceve l’oggetto film e lo utilizza per creare il documento Film (se ancora non esiste). Crea un nuovo documento Attività sulla base dell’oggetto film, dopodichè trova il documento User sulla base dell’id indicato nel payload, poi aggiunge l’id del film alla proprietà “watched”, elimina l’id del film dalla proprietà “watchlist” e infine aggiunge alla proprietà “activity” l’id del documento Activity precedentemente creato.
#### /remove-from-watched/:filmID: rimuove un film dalla lista dei film visti (conoscendo l’id del film). Trova il documento User a partire dall’id contenuto nel payload ed elimina dalla proprietà “watched” l’id del film.
#### /get-watched/:username: permette di ottenere la lista di tutti i film visti dall’utente (conoscendo lo username dell’utente). Trova il documento User a partire dall’id contenuto nel payload e popola le proprietà “watched” e “reviews”, dopodichè modifico ogni oggetto della proprietà “watched” inserendo anche le proprietà isLiked e rating, in modo da mostrare nel front end per ogni film visto se è anche piaciuto all’utente, e l’eventuale rating.  Inoltre, filtro la lista dei film visti sulla base dei filtri di ricerca.
 
 
#### Middleware verifyJWT
Ad ogni richiesta il front end integra nell’header Authorization il valore dell’access token. Per le richieste protette (come aggiungi alla watchlist, elimina recensione, ecc.) bisogna prima verificare l’identità dell’utente, per questo inseriamo prima del controller che esegue la funzione specifica un middleware che verifica prima di tutto che esista l’access token nell’header della richiesta, dopodichè viene usato lo stesso JWT secret usato per firmare l’access token durante il login o il refresh per ricavare il payload. In questo modo il server può verificare se l’access token sia stato manomesso o se è scaduto, perché se lo è allora non srebbe possibile usare il JWT secret per trovare i dati e la richiesta verrebbe bloccata e il backend invierebbe una risposta 401 Unauthorized. Le risposte 401 vengono intercettate dal front end (dall’istanza api creata con Axios) che proverà a refreshare il token oppure, se il refresh fallisce perché il refresh token è scaduto, forza il logout.

 Infine il payload viene inserito nella richiesta originale (proprietà user) e passato al middleware successivo. Ogni api protetta potrà verificare l’identità dell’utente che fa richiesta a partire dal suo id, a cui può accedere con req.user.id, ed in questo modo trovare il documento User corrispondente all’utente che ha fatto richiesta.
 
### Modello dei dati
Nei modelli dei dati abbiamo utilizzato un’associazione tra i modelli tramite referenziazione, piuttosto che un’associazione embedded.
#### User: modello dell’utente che utilizziamo per inserire tutte le proprietà principali per ogni utente, tra cui le info personali (che mostriamo nel profilo), il refresh token creato dopo il login, i vari array dei film (watchlist, liked, ecc..) i cui oggetti fanno riferimento al modello Film, l’array delle recensioni in cui ogni oggetto fa riferimento al modello Review, e infine l’array delle liste create possedute dall’utente, in cui ogni oggetto fa riferimento al modello List.
#### PendingUser: modello dell’utente che vien usato sostanzialmente per verificare se la mail indicata dall’utente sia effettivamente la sua. Ogni documento che sfrutta questo modello contiene momentaneamente i dati di un utente + codice di verifica (inviato alla sua mail) + scadenza del codice, in modo da poter verificare in un secondo momento se il codice di verifica inserito dall’utente corrisponda a quello presente nel documento PendingUser, in caso positivo quest’ultimo viene eliminato. Un documento PendingUser viene usato in due scenari (per ora): quando l’utente clicca sul pulsante “Registrati” oppure quando clicca su “Hai dimenticato la password?”.
#### Film: modello dei film la cui struttura contiene le informazioni essenziali per ogni film che serviranno nella Card del film. Inseriamo anche i generi e l’indicatore di probabilità per poter filtrare i film della watchlist o di altre liste in base al genere inserito o all’ordine di popolarità. Ogni documento che si basa su questo modello ha un _id che corrisponde all’id del film nell’api di TMDB, quindi non è generato automaticamente da Mongoose. Questi documenti andranno a popolare le varie liste che troviamo nelle proprietà di ogni documento dell’utente.
#### Review: modello delle recensioni che contiene essenzialmente la recensione fatta dall’utente, il rating, la data in cui è stata fatta e la proprietà film che contiene l’id del film (nell’api TMDB), ovviamente che fa referenziazione al modello Film. Ovviamente ogni documento Recensione ha un _id diverso, quindi diversamente dai documenti Film, due documenti Recensione posso fare riferimento allo stesso film ma avranno _id diversi perché le recensioni sono state fatte da due utenti diversi.
#### Activity: modello che contiene le informazioni di alcune attività fatte dall’utente, tra cui quando aggiunge un film alla watchlist, ai preferiti, ai film visti, alle recensioni (usiamo enum per indicare che queste solo le uniche azioni che verranno tracciate nelle attività), le informazioni del film in questione e poi le info dell’utente stesso che sono contenute, sempre tramite referenziazione, nella proprietà user.
#### List: modello che possiede le proprietà delle liste dei film dell’utente: abbiamo il nome della lista, la proprietà userID che referenzia al modello User e la proprietà filmID che, come valore, ha un array degli id dei film della lista in questione (ovviamente anche in questo caso viene fatta la referenziazione al modello Film).

